<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Fraction Wall ‚Äî Renewable Energy (Infinity Untangled)</title>
  <meta name="description" content="Interactive Fraction Wall that teaches fractions through renewable energy contributions. Theme: Infinity Untangled." />
  <style>
    /* ---------- THEME: Infinity Untangled (Renewable Energy) ---------- */
    :root{
      --bg-1: #071124; --bg-2: #021022;
      --card: rgba(255,255,255,0.04);
      --muted: rgba(255,255,255,0.6);
      --accent-solar: #ffd166;
      --accent-wind: #7cc7ff;
      --accent-hydro: #6be7d6;
      --accent-bio:  #b2f59b;
      --glass: rgba(255,255,255,0.03);
      --max-rows: 12;
      --radius: 12px;
      font-family: Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg-1),var(--bg-2));color:#eaf5ff}

    /* layout */
    .wrap{max-width:1200px;margin:28px auto;padding:20px;}
    header{display:flex;gap:18px;align-items:center}
    .logo{width:72px;height:72px;border-radius:14px;background:linear-gradient(135deg,var(--accent-wind),var(--accent-solar));display:flex;align-items:center;justify-content:center;font-weight:800;color:#041125;font-size:28px;box-shadow:0 8px 30px rgba(2,6,23,0.6)}
    .title h1{margin:0;font-size:22px}
    .title p{margin:2px 0 0;color:var(--muted);font-size:13px}

    main{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:var(--radius);border:1px solid rgba(255,255,255,0.04);}

    /* Fraction wall */
    .wall{height:620px;padding:12px;border-radius:10px;overflow:auto;position:relative;background:linear-gradient(180deg, rgba(2,6,23,0.2), rgba(2,6,23,0.06));}
    .row{display:flex;height:46px;margin-bottom:8px;gap:8px;align-items:center}
    .segment{flex:1;border-radius:8px;padding:6px 8px;display:flex;align-items:center;justify-content:center;font-weight:700;cursor:pointer;position:relative;user-select:none;transition:transform 300ms, box-shadow 300ms}
    .segment .label{position:absolute;left:8px;top:6px;font-size:11px;opacity:0.95}
    .segment .value{font-size:13px}
    .segment:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(2,6,23,0.5)}
    .seg-solar{background:linear-gradient(90deg,var(--accent-solar),#fff3cc);border:1px solid rgba(255,209,102,0.12);color:#2a1600}
    .seg-wind{background:linear-gradient(90deg,var(--accent-wind),#bfe9ff);border:1px solid rgba(124,199,255,0.12);color:#03223e}
    .seg-hydro{background:linear-gradient(90deg,var(--accent-hydro),#dffaf6);border:1px solid rgba(107,231,214,0.12);color:#003233}
    .seg-bio{background:linear-gradient(90deg,var(--accent-bio),#e9ffd9);border:1px solid rgba(178,245,155,0.12);color:#122800}

    .highlight{outline:5px solid rgba(255,255,255,0.06);transform:translateY(-10px) scale(1.03);box-shadow:0 18px 50px rgba(0,0,0,0.6)}

    /* controls */
    .controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .controls input[type=number]{width:72px;padding:6px;border-radius:8px;border:0;background:transparent;color:inherit}
    .controls label{font-size:13px;color:var(--muted);display:flex;gap:6px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--accent-wind),var(--accent-solar));border:0;padding:8px 12px;border-radius:10px;color:#041125;font-weight:700;cursor:pointer}

    /* info column */
    .info h3{margin:0 0 8px 0}
    .info p{margin:6px 0;color:var(--muted)}
    .chip{display:inline-flex;gap:8px;align-items:center;padding:8px 10px;border-radius:999px;background:rgba(255,255,255,0.03);font-weight:700;margin-right:8px}

    /* sliders & quiz */
    .slider-row{display:flex;gap:8px;align-items:center;margin:10px 0}
    .slider-row input[type=range]{flex:1}
    .quiz-area{margin-top:10px}
    .quiz-area button{margin-top:8px}

    /* infinity svg */
    .infinity-wrap{position:absolute;inset:8px;pointer-events:none;opacity:0.12}
    .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}

    /* leaderboard modal */
    .modal{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.6);z-index:50}
    .modal.active{display:flex}
    .modal .card{background:linear-gradient(180deg,#051022,#08183a);padding:18px;border-radius:12px;width:380px;color:#eaf5ff}

    /* responsive */
    @media (max-width:980px){main{grid-template-columns:1fr} .wall{height:520px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="logo">‚àû</div>
      <div class="title">
        <h1>Fraction Wall ‚Äî Renewable Energy</h1>
        <p>Theme: <em>Infinity ‚Äî Untangled</em> ‚Äî Explore how fractions build infinite sustainable power.</p>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center">
        <div class="controls panel" style="display:flex;align-items:center;gap:10px">
          <label>Rows <input id="rows" type="number" min="1" max="12" value="8"></label>
          <label>Decimals <input id="dec" type="checkbox"></label>
          <button id="regen" class="btn">Regenerate</button>
        </div>
      </div>
    </header>

    <main>
      <section class="panel">
        <div class="wall" id="wall" aria-live="polite" aria-label="Fraction wall representing renewable energy sources">
          <div class="infinity-wrap" aria-hidden>
            <svg viewBox="0 0 1000 600" preserveAspectRatio="none" style="width:100%;height:100%">
              <defs>
                <linearGradient id="gA" x1="0" x2="1"><stop offset="0" stop-color="#7cc7ff" /><stop offset="1" stop-color="#ffd166" /></linearGradient>
              </defs>
              <path d="M50,300 C150,120 350,120 500,300 C650,480 850,480 950,300" stroke="url(#gA)" stroke-width="8" fill="none" stroke-linecap="round" />
            </svg>
          </div>
          <!-- rows injected -->
        </div>
        <div class="footer">Tip: Click a segment to highlight equivalents. Use sliders to customize the energy mix.</div>
      </section>

      <aside class="panel info" aria-hidden>
        <h3>Energy Mix</h3>
        <p>Adjust the sliders to create your own renewable energy mix. Each colored bar in the wall represents a type of energy and its fractional share of total power.</p>

        <div class="slider-row">
          <div style="width:86px" class="chip">Solar ‚òÄÔ∏è</div>
          <input id="solarRange" type="range" min="0" max="100" value="50">
          <div id="solarVal" style="width:36px;text-align:right;font-weight:700">50%</div>
        </div>

        <div class="slider-row">
          <div style="width:86px" class="chip">Wind üå¨Ô∏è</div>
          <input id="windRange" type="range" min="0" max="100" value="25">
          <div id="windVal" style="width:36px;text-align:right;font-weight:700">25%</div>
        </div>

        <div class="slider-row">
          <div style="width:86px" class="chip">Hydro üíß</div>
          <input id="hydroRange" type="range" min="0" max="100" value="12">
          <div id="hydroVal" style="width:36px;text-align:right;font-weight:700">12%</div>
        </div>

        <div class="slider-row">
          <div style="width:86px" class="chip">Bio üå±</div>
          <input id="bioRange" type="range" min="0" max="100" value="13">
          <div id="bioVal" style="width:36px;text-align:right;font-weight:700">13%</div>
        </div>

        <div style="margin-top:12px">
          <button id="normalize" class="btn">Normalize to 100%</button>
          <button id="saveMix" class="btn">Save Mix</button>
          <button id="loadMix" class="btn">Load Mix</button>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.04);margin:12px 0" />

        <div class="quiz-area">
          <h4>Quiz</h4>
          <p id="quizQ">Press 'Start' to launch a timed quiz.</p>
          <div style="display:flex;gap:8px">
            <button id="startQuiz" class="btn">Start</button>
            <button id="submitAns" class="btn">Submit</button>
            <button id="showLeader" class="btn">Leaderboard</button>
          </div>
          <div style="margin-top:8px">Time left: <span id="timer">60</span>s</div>
          <div style="margin-top:8px">Score: <strong id="score">0</strong></div>
        </div>

        <hr style="border:none;border-top:1px solid rgba(255,255,255,0.04);margin:12px 0" />
        <h4>About</h4>
        <p>Fraction Wall ‚Äî Renewable Energy ties mathematical fractions to real-world energy fractions, showing how combined sources form a complete (infinite) sustainable system.</p>
      </aside>
    </main>
  </div>

  <!-- Leaderboard modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="card">
      <h3>Leaderboard</h3>
      <ol id="leaderList"></ol>
      <div style="display:flex;gap:8px;margin-top:12px">
        <input id="playerName" placeholder="Your name" style="flex:1;padding:8px;border-radius:8px;border:0;background:rgba(255,255,255,0.02);color:inherit" />
        <button id="closeModal" class="btn">Close</button>
      </div>
    </div>
  </div>

  <script>
    /* ---------- Data & utilities ---------- */
    const wall = document.getElementById('wall');
    const rowsInput = document.getElementById('rows');
    const decCheckbox = document.getElementById('dec');
    const regenBtn = document.getElementById('regen');

    const solarRange = document.getElementById('solarRange');
    const windRange = document.getElementById('windRange');
    const hydroRange = document.getElementById('hydroRange');
    const bioRange = document.getElementById('bioRange');
    const solarVal = document.getElementById('solarVal');
    const windVal = document.getElementById('windVal');
    const hydroVal = document.getElementById('hydroVal');
    const bioVal = document.getElementById('bioVal');

    const normalizeBtn = document.getElementById('normalize');
    const saveMixBtn = document.getElementById('saveMix');
    const loadMixBtn = document.getElementById('loadMix');

    const startQuizBtn = document.getElementById('startQuiz');
    const submitAnsBtn = document.getElementById('submitAns');
    const quizQ = document.getElementById('quizQ');
    const timerEl = document.getElementById('timer');
    const scoreEl = document.getElementById('score');
    const showLeaderBtn = document.getElementById('showLeader');

    const modal = document.getElementById('modal');
    const leaderList = document.getElementById('leaderList');
    const closeModal = document.getElementById('closeModal');
    const playerName = document.getElementById('playerName');

    const MAX_ROWS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--max-rows')) || 12;

    let quizTimer = null; let quizTime = 60; let quizScore = 0; let currentQuestion = null;

    function gcd(a,b){return b===0?Math.abs(a):gcd(b,a%b)}
    function simplify(n,d){const g=gcd(n,d);return [n/g,d/g]}

    function clamp(v,min,max){return Math.max(min,Math.min(max,v))}

    /* ---------- Fraction Wall Rendering ---------- */
    function buildWall(rows){
      wall.innerHTML = '';
      const r = clamp(rows,1,MAX_ROWS);

      for(let i=1;i<=r;i++){
        const row = document.createElement('div'); row.className='row';

        // decide how many segments of each energy type appear in this row proportionally using slider mix
        const mix = getMixFractions();
        // total segments this row (i) ‚Äî we'll fill with energy segments in proportion to mix
        let remaining = i;

        // compute desired counts (floors) and remainder
        const desired = {
          solar: Math.floor(mix.solar * i),
          wind:  Math.floor(mix.wind  * i),
          hydro: Math.floor(mix.hydro * i),
          bio:   Math.floor(mix.bio   * i)
        };
        // distribute leftover segments to highest fractional remainders
        const remainders = [
          {k:'solar',v:(mix.solar * i)-desired.solar},
          {k:'wind', v:(mix.wind  * i)-desired.wind},
          {k:'hydro',v:(mix.hydro * i)-desired.hydro},
          {k:'bio',  v:(mix.bio   * i)-desired.bio}
        ];
        let used = desired.solar+desired.wind+desired.hydro+desired.bio;
        const leftover = i - used;
        remainders.sort((a,b)=>b.v-a.v);
        for(let x=0;x<leftover;x++){ desired[remainders[x%4].k]++; }

        // create segments in a shuffled order to mix colors visually
        const segments = [];
        ['solar','wind','hydro','bio'].forEach(k=>{
          for(let t=0;t<desired[k];t++) segments.push(k);
        });
        // if something went wrong and segments length != i, adjust
        while(segments.length < i) segments.push('solar');
        // shuffle
        for(let s=segments.length-1;s>0;s--){ const j=Math.floor(Math.random()*(s+1)); [segments[s],segments[j]]=[segments[j],segments[s]] }

        // create DOM
        segments.forEach((type,idx)=>{
          const seg = document.createElement('div'); seg.className='segment seg-'+type;
          seg.tabIndex = 0;
          const lbl = document.createElement('div'); lbl.className='label'; lbl.textContent = `${idx+1}/${i}`;
          const val = document.createElement('div'); val.className='value';
          val.textContent = decCheckbox.checked ? ( (idx+1)/i ).toFixed(3) : `${idx+1}/${i}`;
          seg.appendChild(lbl); seg.appendChild(val);

          seg.dataset.num = idx+1; seg.dataset.den = i; seg.dataset.type = type;

          seg.addEventListener('click', ()=>{ onSegmentSelect(seg) });
          seg.addEventListener('keydown', e=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); onSegmentSelect(seg); } });

          row.appendChild(seg);
        });

        wall.appendChild(row);
      }
    }

    function onSegmentSelect(seg){
      // find equivalents across wall (same fraction simplified)
      const n = parseInt(seg.dataset.num,10); const d = parseInt(seg.dataset.den,10);
      const [sn,sd] = simplify(n,d);
      // announce
      infoText(`${n}/${d} ‚Üí simplified ${sn}/${sd}`);

      // highlight equivalents and animate
      const all = wall.querySelectorAll('.segment');
      all.forEach(s=>{
        const a = parseInt(s.dataset.num,10), b = parseInt(s.dataset.den,10);
        if(a * d === b * n){ s.classList.add('highlight'); } else { s.classList.remove('highlight'); }
      });

      // small particle burst near clicked element
      const rect = seg.getBoundingClientRect(); particleBurst(rect.left + rect.width/2, rect.top + rect.height/2);

      // if quiz active, give points
      if(quizTimer){ quizScore += 5; scoreEl.textContent = quizScore; }
    }

    function infoText(t){ const infoEl = document.getElementById('info'); infoEl.textContent = t; }

    /* ---------- Mix sliders ---------- */
    function updateSliderDisplays(){ solarVal.textContent = solarRange.value + '%'; windVal.textContent = windRange.value + '%'; hydroVal.textContent = hydroRange.value + '%'; bioVal.textContent = bioRange.value + '%'; }

    function getMixFractions(){
      const s = parseInt(solarRange.value,10);
      const w = parseInt(windRange.value,10);
      const h = parseInt(hydroRange.value,10);
      const b = parseInt(bioRange.value,10);
      const total = Math.max(1, s+w+h+b);
      return { solar: s/total, wind: w/total, hydro: h/total, bio: b/total };
    }

    function normalizeMix(){
      const s = parseInt(solarRange.value,10);
      const w = parseInt(windRange.value,10);
      const h = parseInt(hydroRange.value,10);
      const b = parseInt(bioRange.value,10);
      const total = s+w+h+b || 1;
      solarRange.value = Math.round((s/total)*100);
      windRange.value  = Math.round((w/total)*100);
      hydroRange.value = Math.round((h/total)*100);
      bioRange.value   = Math.round((b/total)*100);
      updateSliderDisplays();
      buildWall(parseInt(rowsInput.value,10));
    }

    saveMixBtn.addEventListener('click', ()=>{
      const mix = {s:solarRange.value, w:windRange.value, h:hydroRange.value, b:bioRange.value};
      localStorage.setItem('fw_mix', JSON.stringify(mix));
      alert('Mix saved locally');
    });
    loadMixBtn.addEventListener('click', ()=>{
      const m = JSON.parse(localStorage.getItem('fw_mix')||'null');
      if(m){ solarRange.value=m.s; windRange.value=m.w; hydroRange.value=m.h; bioRange.value=m.b; updateSliderDisplays(); buildWall(parseInt(rowsInput.value,10)); } else { alert('No saved mix found'); }
    });

    normalizeBtn.addEventListener('click', normalizeMix);

    [solarRange,windRange,hydroRange,bioRange].forEach(r=>r.addEventListener('input', ()=>{ updateSliderDisplays(); buildWall(parseInt(rowsInput.value,10)); }));

    /* ---------- Quiz / Leaderboard ---------- */
    startQuizBtn.addEventListener('click', ()=>{
      startQuiz();
    });

    submitAnsBtn.addEventListener('click', ()=>{ answerCurrentQuestion(); });

    function startQuiz(){
      // reset
      quizScore = 0; quizTime = 60; scoreEl.textContent = quizScore; timerEl.textContent = quizTime;
      if(quizTimer) clearInterval(quizTimer);
      quizTimer = setInterval(()=>{ quizTime--; timerEl.textContent = quizTime; if(quizTime<=0){ clearInterval(quizTimer); endQuiz(); } },1000);
      nextQuestion();
    }

    function nextQuestion(){
      // create a random fraction from current wall
      const rowsCount = parseInt(rowsInput.value,10);
      const d = Math.ceil(Math.random()*rowsCount);
      const n = Math.ceil(Math.random()*d);
      currentQuestion = {n,d};
      quizQ.textContent = `Simplify: ${n}/${d}`;
    }

    function answerCurrentQuestion(){
      if(!currentQuestion) return alert('No question active');
      const ans = prompt(`Enter simplified form for ${currentQuestion.n}/${currentQuestion.d} (e.g. 1/2)`);
      if(!ans) return;
      const [a,b] = ans.split('/').map(x=>parseInt(x,10));
      const [sn,sd] = simplify(currentQuestion.n,currentQuestion.d);
      if(a===sn && b===sd){ alert('Correct! +10'); quizScore += 10; } else { alert(`Wrong. Correct: ${sn}/${sd}`); quizScore = Math.max(0,quizScore-5); }
      scoreEl.textContent = quizScore; nextQuestion();
    }

    function endQuiz(){ alert(`Time up! Score: ${quizScore}`); // ask for name to save
      const name = prompt('Save score ‚Äî enter your name:');
      if(name){ saveToLeaderboard(name, quizScore); }
      currentQuestion = null; quizQ.textContent = 'Press Start to launch a timed quiz.';
    }

    function saveToLeaderboard(name, s){ const list = JSON.parse(localStorage.getItem('fw_leader')||'[]'); list.push({name,score:s,date:new Date().toLocaleString()}); list.sort((a,b)=>b.score-a.score); localStorage.setItem('fw_leader', JSON.stringify(list.slice(0,10))); }

    showLeaderBtn.addEventListener('click', ()=>{
      const list = JSON.parse(localStorage.getItem('fw_leader')||'[]'); leaderList.innerHTML=''; if(list.length===0) leaderList.innerHTML='<li>No records yet</li>'; else list.forEach(l=>{ const li=document.createElement('li'); li.textContent = `${l.name} ‚Äî ${l.score} pts (${l.date})`; leaderList.appendChild(li); }); modal.classList.add('active'); modal.setAttribute('aria-hidden','false');
    });
    closeModal.addEventListener('click', ()=>{ modal.classList.remove('active'); modal.setAttribute('aria-hidden','true'); });

    /* ---------- Visual & UX helpers ---------- */
    function particleBurst(x,y){
      for(let i=0;i<6;i++){
        const p = document.createElement('div'); p.style.position='fixed'; p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.width='8px'; p.style.height='8px'; p.style.borderRadius='50%'; p.style.background='rgba(255,255,255,0.85)'; p.style.pointerEvents='none'; p.style.zIndex=60; document.body.appendChild(p);
        const dx = (Math.random()-0.5)*120; const dy = (Math.random()-0.5)*80; let life=24;
        const id = setInterval(()=>{ x += dx/12; y += dy/12; dx *= 0.92; dy *= 0.92; life--; p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.opacity = (life/24); if(life<=0){ clearInterval(id); p.remove(); } }, 16);
      }
    }

    // audio feedback (tiny click)
    const clickAudio = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=');
    document.addEventListener('click', ()=>{ try{ clickAudio.currentTime = 0; clickAudio.play(); }catch(e){} });

    /* ---------- Persistence & init ---------- */
    function init(){ updateSliderDisplays(); buildWall(parseInt(rowsInput.value,10)); }

    regenBtn.addEventListener('click', ()=> buildWall(parseInt(rowsInput.value,10)));
    rowsInput.addEventListener('change', ()=> buildWall(parseInt(rowsInput.value,10)));
    decCheckbox.addEventListener('change', ()=> buildWall(parseInt(rowsInput.value,10)));

    // initial values and event wiring
    updateSliderDisplays(); init();

    // accessibility: keyboard shortcuts
    window.addEventListener('keydown', (e)=>{
      if(e.key.toLowerCase()==='r'){ buildWall(parseInt(rowsInput.value,10)); }
      if(e.key.toLowerCase()==='n'){ normalizeMix(); }
      if(e.key.toLowerCase()==='s'){ saveMixBtn.click(); }
    });

  </script>
</body>
</html>